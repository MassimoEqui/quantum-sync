(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 13.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     11647,        286]
NotebookOptionsPosition[     10797,        266]
NotebookOutlinePosition[     11223,        283]
CellTagsIndexPosition[     11180,        280]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"Ctrl", "+", "A"}], " ", "->", " ", 
   RowBox[{
    RowBox[{"Ctrl", "+", "C"}], " ", "->", " ", 
    RowBox[{
     RowBox[{"Ctrl", "+", 
      RowBox[{
      "V", " ", "at", " ", "the", " ", "beginning", " ", "of", " ", "the", 
       " ", "notebook", " ", "of", " ", "interest"}]}], " ", "->", " ", 
     RowBox[{"delete", " ", "this", " ", "comment", " ", "line"}]}]}]}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.9544721718778653`*^9, 3.9544721738197556`*^9}, 
   3.9544722425853634`*^9, {3.95447238477981*^9, 3.9544723867080336`*^9}, {
   3.9690060319616823`*^9, 
   3.9690061376497917`*^9}},ExpressionUUID->"8efac4f6-6802-4dbc-95bd-\
03074a2d681c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"KP", " ", "[", 
   RowBox[{"A_", ",", "B_"}], "]"}], ":=", 
  RowBox[{"KroneckerProduct", "[", 
   RowBox[{"A", ",", "B"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.9544723616457725`*^9, 3.9544723813955336`*^9}, 
   3.954475616973494*^9, {3.954480321454058*^9, 3.9544803295575323`*^9}, {
   3.954480767665183*^9, 3.954480776304665*^9}, {3.968206617298685*^9, 
   3.968206624423469*^9}, {3.9682066609118643`*^9, 3.968206667399624*^9}},
 CellLabel->"In[36]:=",ExpressionUUID->"4a9d0ef1-06af-4134-9000-54a1a20b7488"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Id", "[", "i_", "]"}], ":=", 
   RowBox[{"IdentityMatrix", "[", "i", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.9544802057292013`*^9, 3.95448027743918*^9}, {
   3.954480345213148*^9, 3.95448036539491*^9}, {3.9544804003658557`*^9, 
   3.9544804024432755`*^9}, {3.9544804472450204`*^9, 3.954480451751522*^9}, {
   3.954480589707246*^9, 3.954480594415642*^9}, {3.9544806578557124`*^9, 
   3.9544806824551587`*^9}, {3.9544807154216747`*^9, 
   3.9544807360397615`*^9}, {3.9544807818856854`*^9, 
   3.9544808596344547`*^9}, {3.9544808990704603`*^9, 3.954480979477294*^9}, {
   3.954481034475541*^9, 3.954481073442427*^9}, {3.954481182251497*^9, 
   3.9544811824948983`*^9}, {3.968206750541381*^9, 3.968206789094885*^9}, 
   3.96820703082395*^9, {3.968207863200145*^9, 3.9682078670111217`*^9}},
 CellLabel->"In[37]:=",ExpressionUUID->"58a3d835-7cef-419e-b04b-a00865a149a8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"DiagBlockSum", "[", 
   RowBox[{"A_", ",", "n_", ",", "m_"}], "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Dimensions", "[", "A", "]"}], "==", 
     RowBox[{"{", 
      RowBox[{"n", ",", "m"}], "}"}]}], ",", "\[IndentingNewLine]", "A", ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"A", "[", 
      RowBox[{"[", 
       RowBox[{
        RowBox[{"1", ";;", "n"}], ",", 
        RowBox[{"1", ";;", "m"}]}], "]"}], "]"}], "+", 
     RowBox[{"DiagBlockSum", "[", 
      RowBox[{
       RowBox[{"A", "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{
           RowBox[{"n", "+", "1"}], ";;", 
           RowBox[{
            RowBox[{"Dimensions", "[", "A", "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"m", "+", "1"}], ";;", 
           RowBox[{
            RowBox[{"Dimensions", "[", "A", "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}], "]"}], ",", "n", ",", 
       "m"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.968210151415202*^9, 3.968210240598044*^9}, {
  3.9682103212419662`*^9, 3.968210375205567*^9}, {3.968210723451589*^9, 
  3.968210730422597*^9}, {3.968210790762631*^9, 3.968210801385643*^9}, {
  3.9682109326117153`*^9, 3.9682109331070967`*^9}, {3.9682111703352222`*^9, 
  3.9682112256464*^9}, {3.9682113394402733`*^9, 3.968211451816524*^9}, {
  3.968211482530217*^9, 3.968211519757506*^9}, {3.9682115675505943`*^9, 
  3.968211583607259*^9}, {3.968211710455554*^9, 3.96821171559689*^9}, {
  3.968211748275117*^9, 3.968211749994587*^9}},
 CellLabel->"In[38]:=",ExpressionUUID->"0515c45d-2bfa-47b7-9fa5-e37caec0bb5c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Requirement", ":", " ", 
    RowBox[{"l", "<=", "idx"}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"PushLeftSingle", "[", 
     RowBox[{"\[Rho]_", ",", "l_", ",", "idx_"}], "]"}], ":=", " ", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"l", "==", "idx"}], ",", "\[IndentingNewLine]", "\[Rho]", ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"P21", "=", 
        RowBox[{"PermutationMatrix", "[", 
         RowBox[{"{", 
          RowBox[{"1", ",", "3", ",", "2", ",", "4"}], "}"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"n", "=", 
        RowBox[{"Log", "[", 
         RowBox[{"2", ",", 
          RowBox[{
           RowBox[{"Dimensions", "[", "\[Rho]", "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"P", "=", 
        RowBox[{"Id", "[", "N", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"2", "==", "idx"}], " ", "&&", " ", 
          RowBox[{"idx", "==", "n"}]}], ",", 
         RowBox[{"P", "=", "P21"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"2", "==", "idx"}], " ", "&&", " ", 
          RowBox[{"idx", "<", "n"}]}], ",", 
         RowBox[{"P", "=", 
          RowBox[{"KP", "[", 
           RowBox[{"P21", ",", 
            RowBox[{"Id", "[", 
             RowBox[{"2", "^", 
              RowBox[{"(", 
               RowBox[{"n", "-", "2"}], ")"}]}], "]"}]}], "]"}]}]}], "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"2", "<", "idx"}], " ", "&&", " ", 
          RowBox[{"idx", "==", "n"}]}], ",", 
         RowBox[{"P", "=", 
          RowBox[{"KP", "[", 
           RowBox[{
            RowBox[{"Id", "[", 
             RowBox[{"2", "^", 
              RowBox[{"(", 
               RowBox[{"n", "-", "2"}], ")"}]}], "]"}], ",", "P21"}], 
           "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"2", "<", "idx"}], " ", "&&", " ", 
          RowBox[{"idx", "<", "n"}]}], ",", 
         RowBox[{"P", "=", 
          RowBox[{"KP", "[", 
           RowBox[{
            RowBox[{"Id", "[", 
             RowBox[{"2", "^", 
              RowBox[{"(", 
               RowBox[{"idx", "-", "2"}], ")"}]}], "]"}], ",", 
            RowBox[{"KP", "[", 
             RowBox[{"P21", ",", 
              RowBox[{"Id", "[", 
               RowBox[{"2", "^", 
                RowBox[{"(", 
                 RowBox[{"n", "-", "idx"}], ")"}]}], "]"}]}], "]"}]}], 
           "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"PushLeftSingle", "[", 
        RowBox[{
         RowBox[{"P", ".", "\[Rho]", ".", "P"}], ",", "l", ",", 
         RowBox[{"idx", "-", "1"}]}], "]"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"PushLeftMultiple", "[", 
     RowBox[{"\[Rho]_", ",", "l_", ",", "idxList_"}], "]"}], ":=", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Dimensions", "[", "idxList", "]"}], "==", 
       RowBox[{"{", "0", "}"}]}], ",", "\[IndentingNewLine]", "\[Rho]", ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"idx", "=", 
        RowBox[{"idxList", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"\[Rho]1", "=", 
        RowBox[{"PushLeftSingle", "[", 
         RowBox[{"\[Rho]", ",", "l", ",", "idx"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"PushLeftMultiple", "[", 
        RowBox[{"\[Rho]1", ",", 
         RowBox[{"l", "+", "1"}], ",", 
         RowBox[{"Drop", "[", 
          RowBox[{"idxList", ",", "1"}], "]"}]}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.9682935378402977`*^9, 3.968293738924704*^9}, {
   3.968293802000375*^9, 3.968293833389565*^9}, {3.968293867262144*^9, 
   3.96829386736274*^9}, {3.968293936453393*^9, 3.9682939863873043`*^9}, 
   3.968310030556836*^9, 3.968314507379732*^9, {3.9683145516645412`*^9, 
   3.9683145551028137`*^9}, 3.9683146147609863`*^9, {3.9683157674306173`*^9, 
   3.968315768247941*^9}, {3.96831580576513*^9, 3.968315805766162*^9}, {
   3.96872011533882*^9, 3.968720200400894*^9}, {3.9687237031085443`*^9, 
   3.968723756163076*^9}, {3.9687238095413094`*^9, 3.968723814936988*^9}, {
   3.968723900762911*^9, 3.968723936689054*^9}, {3.968724104851779*^9, 
   3.968724170819515*^9}, {3.968724222967721*^9, 3.968724315799903*^9}},
 CellLabel->"In[39]:=",ExpressionUUID->"dd44e5f4-cd58-450c-b19e-e8cf89e33dc5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"TraceOut", "[", 
   RowBox[{"\[Rho]_", ",", "idxList_"}], "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Rho]1", "=", 
     RowBox[{"PushLeftMultiple", "[", 
      RowBox[{"\[Rho]", ",", "1", ",", "idxList"}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"n", "=", 
     RowBox[{"2", "^", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"Log", "[", 
          RowBox[{"2", ",", 
           RowBox[{"Dimensions", "[", "\[Rho]", "]"}]}], "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}], "-", 
        RowBox[{
         RowBox[{"Dimensions", "[", "idxList", "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"DiagBlockSum", "[", 
     RowBox[{"\[Rho]1", ",", "n", ",", "n"}], "]"}]}], "\[IndentingNewLine]", 
   ")"}]}]], "Input",
 CellChangeTimes->{{3.968315821314033*^9, 3.968315875961461*^9}, {
  3.968724982162462*^9, 3.968725019020626*^9}, {3.96872512216494*^9, 
  3.968725188038664*^9}, {3.968725262147414*^9, 3.968725330375609*^9}, {
  3.968725373344511*^9, 3.968725464039709*^9}, {3.968725536290206*^9, 
  3.968725536656651*^9}, {3.968725567394877*^9, 3.968725577374813*^9}, {
  3.968725607725322*^9, 3.9687256484207363`*^9}, {3.9687271433661537`*^9, 
  3.968727144599218*^9}, {3.968728178707821*^9, 3.968728193360652*^9}, {
  3.9687282412047043`*^9, 3.968728249562725*^9}},
 CellLabel->"In[41]:=",ExpressionUUID->"62726d6e-d681-4deb-92ef-e153bc7394ff"]
},
WindowSize->{1383, 855},
WindowMargins->{{-2.25, Automatic}, {Automatic, -22.5}},
Magnification:>1. Inherited,
FrontEndVersion->"14.1 for Linux x86 (64-bit) (July 16, 2024)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"2a655cb7-fb0d-4c34-a86f-1e78fc106545"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 707, 17, 29, "Input",ExpressionUUID->"8efac4f6-6802-4dbc-95bd-03074a2d681c"],
Cell[1268, 39, 548, 10, 29, "Input",ExpressionUUID->"4a9d0ef1-06af-4134-9000-54a1a20b7488"],
Cell[1819, 51, 919, 15, 29, "Input",ExpressionUUID->"58a3d835-7cef-419e-b04b-a00865a149a8"],
Cell[2741, 68, 1729, 41, 89, "Input",ExpressionUUID->"0515c45d-2bfa-47b7-9fa5-e37caec0bb5c"],
Cell[4473, 111, 4790, 117, 383, "Input",ExpressionUUID->"dd44e5f4-cd58-450c-b19e-e8cf89e33dc5"],
Cell[9266, 230, 1527, 34, 109, "Input",ExpressionUUID->"62726d6e-d681-4deb-92ef-e153bc7394ff"]
}
]
*)

